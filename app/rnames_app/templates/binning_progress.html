{% extends 'base_generic.html' %}
{% block title %}RNames - Home{% endblock %}

{% block content %}
  <!-- Beginning of binning -->
  <!DOCTYPE html>

<section class="w3-section">
  <h2>Binning progress information</h2>
  <p id="binningProgressLabel">Binning progress:</p>

  <div id="binningProgressBarContainer" class="w3-light-grey">
    <div id="binningProgressBar" class="w3-container w3-green" style="height:24px; width:0%" />
  </div>

  <p id="updateProgressLabel" class="w3-hide">Database update progress:</p>
  <div id="updateProgressBarContainer" class="w3-light-grey w3-hide">
    <div id="updateProgressBar" class="w3-container w3-green" style="height:24px; width:0%" />
  </div>
</section>

<script>

window.addEventListener('DOMContentLoaded', () => {
  const binningProgressBar = document.getElementById('binningProgressBar')

  const updateProgressLabel = document.getElementById('updateProgressLabel')
  const updateProgressBar = document.getElementById('updateProgressBar')
  const updateProgressBarContainer = document.getElementById('updateProgressBarContainer')
  const update = () => fetch('/rnames/admin/binning_info')
    .then(v => v.json())
    .then(v => {
      binningProgressBar.style.width = `${v.binning[0] / v.binning[1] * 100}%`
      if (v.binning[0] == v.binning[1]) {
        updateProgressLabel.classList.remove('w3-hide')
        updateProgressBarContainer.classList.remove('w3-hide')
        updateProgressBar.style.width = `${v.update[0] / v.update[1] * 100}%`
      }
    })
  update()
  setInterval(update, 5000)
});
</script>
  <!-- End of binning -->

{% endblock %}
